
## Анализ сайта [Ulmart]

Сайт [Ulmart] был выбран для анализа поскольку неоднократно отмечалась его медленная работа на различных устройствах, особенно на маломощных.

Сайт [Ulmart] был проанализирован при помощи следующих сервисов и плагинов:
- WebPageTest
- YSlow
- PageSpeed Insights

[Результаты](https://www.webpagetest.org/result/160804_S4_B67)  тестирования WebPageTest. 

### 1. Использование нескольких ДЦ.
Не применяется, существует только одна копия сайта, Согласно полученным данным с DNS сервера, к домену ulmart.ru привязан только один IP адрес - 178.248.236.28. Так же, как и с первым сайтом, при росте нагрузок на сервер нужно использовать методы балансировки нагрузки на несколько серверов, в первую очередь для статики (в данном случае картинки товаров).

### 2. Размер ресурсов

Распределение размера загружаемых ресурсов можно увидеть на графике ниже:

![ulmart_04](https://cloud.githubusercontent.com/assets/18663439/17391425/ab89ad94-5a1e-11e6-8e6a-7eeb3e7fd608.png)

Несмотря на то, что он не является чрезмерно большим (около 4 Мб), можно дать рекомендацию уменьшить его, т.к. при открытии сайта через мобильные сети это будет актуально.

### 3. Порядок подключения и блокирующие скрипты

Было выявлено большое число блокирующего javascript, подключенного в head документа - 14 внешних файлов, а так же много инлайн блоков. В самом низу страницы присутствует лишь пара небольших инлайн блоков со криптами.
Необходимо убрать из заголовка вниз страницы подключения скриптов, а также вынести во внешний файл инлайн блоки.

Так же при загрузке страницы загружаются неиспользуемые стили, необходимо оптимизировать загрузку  css и все стили, которые не нужны, в момент загрузки подгружать после рендеринга страницы.

### 4. DNS Lookup

Анализатор WebPageTest показал, что число используемых доменов очень велико и равно 124. Среди большого списка присутствует огромное разнообразие рекламных и прочих сервисов. Нужно пересмотреть необходимость присутствия всех и уменьшить их число.

![ulmart_07](https://cloud.githubusercontent.com/assets/18663439/17391499/3c70b604-5a1f-11e6-9351-715091f0e073.png)


### 5. Кэширование

Анализатор PageSpeed выявил, что отсутствует информация о времени жизни (expiration) для некоторых статических ресурсов. Необходимо установить его в максимальное значение для предотвращения повторной перезагрузки.

Выявлено большое число статических ресурсов, которые лежат в отдельных поддоменах (2b27s4p.fast.ulmart.ru, p.fast.ulmart.ru), однако, данные поддомены не являются cookie-free, что приводит к увеличению траффика при загрузке ресурсов с них. Необходимо отключить cookie на указанных поддоменах.

### 6. Сжатие картинок

Нельзя использовать уменьшение картинок средствами css. На анализируемой странице было выявлено 31 изображение, уменьшенное при помощи css стилей. Например: https://p.fast.ulmart.ru/p/mid/383/38327/3832737.jpg
Так же изображения не являются прогрессивными. Необходимо сделать их таковыми с помощью утилиты jpegtran.

### 7. Объединение, минификация и обфускация файлов

В коде страницы присутствует большое число неминифицированных инлайн блоков скриптов с комментариями. Необходимо вынести в их отдельный файл и провести минификацию.
Кроме того был обнаружен уже знакомый по первому анализу неминифицированный файл "openapi.js" от ВКонтакте, но с ним ничего поделать нельзя.
Так же для всех javascript файлов необходимо провести обфускацию с целью уменьшения их объема.

### 8. Количество запросов

При загрузке страницы происходит большое число запросов.
Необходимо объединить используемые  скрипты и css стили в одни файл, загружать картинки динамически по мере надобности, картинки необходимые при первой загрузке и иконки объединить в spritesheets.
По данным Yslow:
> This page has 50 external Javascript scripts. Try combining them into one.

> This page has 8 external stylesheets. Try combining them into one.

> This page has 19 external background images. Try combining them with CSS sprites.

Исходя из данных анализатора WebPageTest, так же видно что, при повторном запросе (правая таблица на скриншоте ниже, левая показывает первый запрос), происходит выполнение большого числа запросов, причем многие из них с поддоменов основного домена:

![ulmart_12](https://cloud.githubusercontent.com/assets/18663439/17391508/51a2f078-5a1f-11e6-8463-5f3e5ef81c8d.png)

### 9. Формирование критичной функциональности

Как и в случае с первым анализируемым сайтом, необходимо определить критичную функциональность и, по возможности, передавать необходимые данные размером до 14 кб в первом пакете, чтобы пользователь мог в первую очередь получить самое необходимое с чем сможет сразу работать.

### 10. Количество элементов в DOM

Сайт содержит большое количество DOM элементов. Анализатор Yslow сообщает о наличии более 5 тыс элементов. Возможно, при более тщательной верстке документа удастся избавиться от их части не меняя содержимого страницы.

### 11. Размер cookie

Анализатор Yslow предупреждает о присутствии cookie достаточно большого рамера. Необходимо уменьшить объем сохраняемых в cookie данных.

### 12. Время ответа сервера

Анализатор PageSpeed выявил достаточно большое время, необходимое на ответ сервера - 500 мс. Необходимо ускорить работу back-end, в первую очередь путем оптимизации серверного кода.

Подводя итог, можно сказать что несмотря на то, что сайт Юлмарта сам по себе достаточно тяжелый и включает большое число элементов, можно провести его оптимизацию и ускорить работу фронт-енда путем выполнения указанных рекомендаций. Но остается еще серверная часть, которая с точки зрения разработчика фронт-енда является черным ящиком и, к сожалению, так же работает медленно на данном сайте.

[Ulmart]: <ulmart.ru>